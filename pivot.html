<html>
<style>
    table, th, td
    {
        margin:10px 0;
        border:solid 1px #333;
        padding:2px 4px;
        font:15px Verdana;
    }
    th {
        font-weight:bold;
    }
</style>
<body>
</body>
<script>
let data =
  [
    {"year": 2014, "department": "NY", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2014, "department": "Moscow", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2014, "department": "Tokyo", "brand": "Toyota", "model": "Corolla", "type": "sedan", "price": "18000"},
    {"year": 2014, "department": "NY", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2014, "department": "Moscow", "brand": "Toyota", "model": "Highlander", "type": "suv", "price": "35000"},
    {"year": 2014, "department": "Tokyo", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2015, "department": "NY", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2015, "department": "Moscow", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2015, "department": "Tokyo", "brand": "Toyota", "model": "Corolla", "type": "sedan", "price": "18000"},
    {"year": 2015, "department": "Tokyo", "brand": "Toyota", "model": "Corolla", "type": "sedan", "price": "18000"},
    {"year": 2015, "department": "NY", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2015, "department": "NY", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2015, "department": "Moscow", "brand": "Toyota", "model": "Highlander", "type": "suv", "price": "35000"},
    {"year": 2015, "department": "Tokyo", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2015, "department": "Tokyo", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2016, "department": "NY", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2016, "department": "Moscow", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2016, "department": "Tokyo", "brand": "Toyota", "model": "Corolla", "type": "sedan", "price": "18000"},
    {"year": 2016, "department": "NY", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2016, "department": "Moscow", "brand": "Toyota", "model": "Highlander", "type": "suv", "price": "35000"},
    {"year": 2016, "department": "Tokyo", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2016, "department": "NY", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2016, "department": "Moscow", "brand": "Toyota", "model": "Camry", "type": "sedan", "price": "27000"},
    {"year": 2016, "department": "Tokyo", "brand": "Toyota", "model": "Corolla", "type": "sedan", "price": "18000"},
    {"year": 2016, "department": "NY", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2016, "department": "Moscow", "brand": "Toyota", "model": "Highlander", "type": "suv", "price": "35000"},
    {"year": 2016, "department": "Tokyo", "brand": "Toyota", "model": "Rav4", "type": "suv", "price": "30000"},
    {"year": 2014, "department": "NY", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2014, "department": "Moscow", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2014, "department": "Tokyo", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2014, "department": "NY", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2014, "department": "Moscow", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2014, "department": "Tokyo", "brand": "Honda", "model": "Pilot", "type": "suv", "price": "38000"},
    {"year": 2015, "department": "NY", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2015, "department": "Moscow", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2015, "department": "Tokyo", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2015, "department": "Moscow", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2015, "department": "Tokyo", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2015, "department": "NY", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2015, "department": "Moscow", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2015, "department": "NY", "brand": "Honda", "model": "Pilot", "type": "suv", "price": "38000"},
    {"year": 2015, "department": "Tokyo", "brand": "Honda", "model": "Pilot", "type": "suv", "price": "38000"},
    {"year": 2016, "department": "NY", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2016, "department": "Moscow", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2016, "department": "Tokyo", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2016, "department": "Moscow", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2016, "department": "Tokyo", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2016, "department": "NY", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "Moscow", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "NY", "brand": "Honda", "model": "Pilot", "type": "suv", "price": "38000"},
    {"year": 2016, "department": "Tokyo", "brand": "Honda", "model": "Pilot", "type": "suv", "price": "38000"},
    {"year": 2016, "department": "NY", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2016, "department": "Moscow", "brand": "Honda", "model": "Accord", "type": "sedan", "price": "24000"},
    {"year": 2016, "department": "Tokyo", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2016, "department": "Moscow", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2016, "department": "Tokyo", "brand": "Honda", "model": "Civic", "type": "sedan", "price": "16000"},
    {"year": 2016, "department": "NY", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "Moscow", "brand": "Honda", "model": "CR-V", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "NY", "brand": "Honda", "model": "Pilot", "type": "suv", "price": "38000"},
    {"year": 2016, "department": "Tokyo", "brand": "Honda", "model": "Pilot", "type": "suv", "price": "38000"},
    {"year": 2014, "department": "NY", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2014, "department": "Moscow", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2014, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2014, "department": "NY", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2014, "department": "Moscow", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2014, "department": "Tokyo", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2014, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2014, "department": "NY", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2014, "department": "Moscow", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2015, "department": "NY", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2015, "department": "NY", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2015, "department": "Moscow", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2015, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2015, "department": "Moscow", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2015, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2015, "department": "NY", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2015, "department": "Moscow", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2015, "department": "NY", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2015, "department": "NY", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2015, "department": "Tokyo", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2015, "department": "Tokyo", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2015, "department": "Tokyo", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "Teana", "type": "sedan", "price": "30000"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pulsar", "type": "sedan", "price": "17000"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "Moscow", "brand": "Nissan", "model": "X-Trail", "type": "suv", "price": "32000"},
    {"year": 2016, "department": "NY", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"},
    {"year": 2016, "department": "Tokyo", "brand": "Nissan", "model": "Pathfinder", "type": "suv", "price": "37500"}
];

let cols = ["brand", "type"] ;
let rows = ["year", "department"];
let operator = 'sum';
let value = 'price';

let uniquePropertyValues = function(objects, properties) {
  let result = [];

  objects.forEach(o => {
    let object = {};
    properties.forEach(p => object[p] = o[p]);
    object = JSON.stringify(object);
    if (result.indexOf(object) < 0) {
      result.push(object);
    }
  });

  return result.map(x => JSON.parse(x));
};

let uniqueRows = uniquePropertyValues(data, rows);
let uniqueCols = uniquePropertyValues (data, cols);

let table = document.createElement("table");
for (let i = 0; i < uniqueRows.length + cols.length ; i++) {
  let tr = table.insertRow(-1);
  let prevCell = null;

  for (let j = 0; j <= uniqueCols.length + rows.length; j++) {
    let cell = tr.insertCell(-1);
    cell.innerHTML = '&nbsp;';
    if (i == cols.length - 1 && j < rows.length) {
      cell.innerHTML = rows[j] ;
    }
    if (i < cols.length  && j == rows.length ) {
      cell.innerHTML = cols[i] ;
    }
    if (i < cols.length) {
      if (j > rows.length) {
        cell.innerHTML = uniqueCols[j - rows.length - 1][cols[i]];
        if (prevCell) {
          if (prevCell.innerHTML == cell.innerHTML) {
            if (!prevCell.hasAttribute("colspan")) {
              prevCell.setAttribute("colspan", 2);
            } else {
              prevCell.setAttribute("colspan", Number(prevCell.getAttribute("colspan")) + 1);
            }
            tr.deleteCell(cell.cellIndex);
            cell = prevCell;
          }
        }
        prevCell = cell;
      }
    } else {
      if (j < rows.length) {
        if (i == cols.length - 1) {
          cell.innerHTML = rows[j];
        } else {
          cell.innerHTML = uniqueRows[i - cols.length][rows[j]];
        }
      }
      if (j == rows.length) {
        table.rows[i].cells[cell.cellIndex - 1].setAttribute("colspan", 2);
        table.rows[i].deleteCell(cell.cellIndex);
      }
      if (j > rows.length) {
        fields = Object.assign({},uniqueCols[j - rows.length - 1], uniqueRows[i - cols.length]);
        for (let d = 0 ; d < data.length; d++) {
          found = true;
          for (var key in fields) {
            if (fields.hasOwnProperty(key)) {
              if (data[d][key] != fields[key]) found = false;
            }
          }
          if (found) {
            if (cell.innerHTML == '&nbsp;') {
              cell.innerHTML = 0;
            }
            if (operator == 'sum') {
              cell.innerHTML = Number(cell.innerHTML) + Number(data[d][value]) ;
            }
            if (operator == 'count') {
              cell.innerHTML = Number(cell.innerHTML) + 1;
            }
          }
        }
      }
    }
  }
}

for (let i = rows.length - 1; i >= 0 ; i--) {
  if (i === 0) {
    table.rows[0].cells[0].setAttribute("colspan", rows.length );
  } else {
    table.rows[0].deleteCell(i);
  }
  let first = null;
  for (let j = cols.length, count = 1; j < cols.length + uniqueRows.length + 1; j++ ) {
    if (first !== null) {
      if (j < table.rows.length && first.innerHTML == table.rows[j].cells[i].innerHTML) {
        count++;
      } else {
        first.setAttribute("rowspan", count);
        while (count > 1) {
          table.rows[first.parentNode.rowIndex + count - 1].deleteCell(i);
          count--;
        }
        if (j < table.rows.length) {
          first = table.rows[j].cells[i];
        }
      }
    } else {
      first = table.rows[j].cells[i];
    }
  }
}

document.body.appendChild(table);
</script>
</html>
